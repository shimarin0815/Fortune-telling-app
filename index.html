<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¸€è¡ŒãŠã¿ãã˜ â€” ãã‚‡ã†ã®ãƒ’ãƒ³ãƒˆã€ãã£ã¨ç½®ã„ã¨ãã¾ã™ã€‚</title>
  <meta name="theme-color" content="#ffe9f1" />
  <style>
    :root{
      --bg-sakura-from:#FFF7FB; --bg-sakura-via:#FFF1F7; --bg-sakura-to:#FFE9F1;
      --bg-mizu-from:#F7FBFF;   --bg-mizu-via:#F0FAFF;   --bg-mizu-to:#E7F7FF;
      --ink:#111827; --muted:#6B7280; --card:#ffffffcc; --border:#ffffff80;
      --ring:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic UI","Yu Gothic",Meiryo,sans-serif;
      color:var(--ink);
      background: linear-gradient(180deg,var(--bg-sakura-from),var(--bg-sakura-via),var(--bg-sakura-to));
      min-height:100svh;
    }
    .wrap{max-width:680px;margin:0 auto;padding:24px 16px 96px}
    header{display:flex;align-items:center;justify-content:space-between;padding-top:24px;padding-bottom:8px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand-badge{height:36px;width:36px;border-radius:16px;background:#fff7;backdrop-filter:blur(6px);display:grid;place-items:center;box-shadow:0 1px 4px #0001}
    .muted{color:var(--muted);font-size:12px}
    .card{background:var(--card);backdrop-filter:blur(6px);border:1px solid var(--border);border-radius:22px;box-shadow:0 8px 24px #0000000d;padding:20px}
    .btn{appearance:none;border:none;border-radius:999px;padding:10px 14px;font-size:14px;cursor:pointer}
    .btn-primary{background:#111827;color:#fff}
    .btn-ghost{background:#fff;border:1px solid #e5e7eb}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .spacer{height:6px}
    .tabs{display:flex;gap:8px;margin:12px 0}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid transparent;background:transparent}
    .tab.active{background:#fff;border-color:#e5e7eb;box-shadow:0 1px 3px #0001}
    .theme{
      display:flex;gap:4px;align-items:center;background:#fff7;border:1px solid var(--border);padding:4px;border-radius:999px
    }
    .theme button{padding:6px 10px;border-radius:999px;border:0;background:transparent;font-size:12px;cursor:pointer}
    .theme button.active{background:#111827;color:#fff}
    .color-dot{width:24px;height:24px;border-radius:999px;border:1px solid #00000010}
    .archive-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px dashed #e5e7eb}
    .archive-item:last-child{border-bottom:0}
    .a11y-note{font-size:11px;color:var(--muted);margin-top:6px}
    /* Mizu theme background */
    .mizu{
      background: linear-gradient(180deg,var(--bg-mizu-from),var(--bg-mizu-via),var(--bg-mizu-to));
    }
    blockquote{margin:0;font-size:20px;line-height:1.6;letter-spacing:.01em}
    .small{font-size:12px}
    .field{margin:8px 0}
    .input{width:100%;padding:10px 12px;border-radius:14px;border:1px solid #e5e7eb;background:#fff}
    footer{margin-top:28px;text-align:center;font-size:11px;color:var(--muted)}
  </style>
  <!-- ç”»åƒåŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆCDNï¼‰ -->
  <script src="https://unpkg.com/html-to-image@1.11.11/dist/html-to-image.js"></script>
</head>
<body>
  <div id="app" class="wrap">
    <header>
      <div class="brand">
        <div class="brand-badge" aria-hidden="true">âœ¨</div>
        <div>
          <div style="font-weight:600">ä¸€è¡ŒãŠã¿ãã˜</div>
          <div class="muted">ãã‚‡ã†ã®ãƒ’ãƒ³ãƒˆã€ãã£ã¨ç½®ã„ã¨ãã¾ã™ã€‚</div>
        </div>
      </div>
      <div class="theme" role="tablist" aria-label="ãƒ†ãƒ¼ãƒé¸æŠ">
        <button id="themeSakura" class="active" role="tab" aria-selected="true">Sakura</button>
        <button id="themeMizu" role="tab" aria-selected="false">Mizu</button>
      </div>
    </header>

    <section class="field">
      <label class="muted" for="nick">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ãƒ»ç«¯æœ«ã«ã®ã¿ä¿å­˜ï¼‰</label>
      <input id="nick" class="input" maxlength="16" placeholder="ä¾‹ï¼šã—ã¾ã‚Šã‚“" />
    </section>

    <nav class="tabs">
      <button id="tabToday" class="tab active">ä»Šæ—¥</button>
      <button id="tabArchive" class="tab">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</button>
    </nav>

    <!-- Today Pane -->
    <main id="paneToday">
      <div id="card" class="card" aria-live="polite">
        <div id="placeholder">
          <div class="muted" style="text-align:center;margin-bottom:8px">ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§ä»Šæ—¥ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹</div>
          <div style="text-align:center">
            <button id="btnReveal" class="btn btn-primary">âœ¨ ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹</button>
          </div>
        </div>

        <div id="content" style="display:none">
          <div class="row" style="justify-content:space-between;align-items:center">
            <div>
              <div class="small muted" id="dateText"></div>
              <div style="font-weight:600">ä»Šæ—¥ã®ä¸€è¡Œ</div>
            </div>
            <button id="btnReroll" class="btn btn-ghost small">âŸ³ ã‚‚ã†ä¸€å›ã ã‘</button>
          </div>

          <blockquote id="oneLiner"></blockquote>

          <div class="row" style="align-items:center">
            <div id="colorDot" class="color-dot" aria-hidden="true"></div>
            <div>
              <div id="colorJa" style="font-weight:500"></div>
              <div id="colorAlt" class="muted small"></div>
            </div>
          </div>

          <div class="card" style="background:#f8fafc;border-color:#f1f5f9;margin-top:6px">
            <span class="muted small">ä»Šæ—¥ã®ã²ã¨ã“ã¨ </span><span id="tipText"></span>
          </div>

          <div class="row" style="margin-top:8px">
            <button id="btnShareImg" class="btn btn-primary">ğŸ“¤ ç”»åƒã§ã‚·ã‚§ã‚¢</button>
            <button id="btnCopy" class="btn btn-ghost">ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
            <button id="btnSaveImg" class="btn btn-ghost">â¬‡ï¸ ç”»åƒä¿å­˜</button>
          </div>
        </div>
      </div>
      <p class="a11y-note">â€» å€‹äººæƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«å†…ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
    </main>

    <!-- Archive Pane -->
    <main id="paneArchive" style="display:none">
      <div class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
          <span>ğŸ•˜</span><h2 style="margin:0;font-size:16px">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆç›´è¿‘7ä»¶ï¼‰</h2>
        </div>
        <div id="archList" class="small muted">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šæ—¥ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</div>
      </div>
    </main>

    <footer>Â© <span id="year"></span> Ichigo Omikuji â€” å„ªã—ã„ä¸€è¡Œã§ã€ä»Šæ—¥ã‚’å°‘ã—è»½ãã€‚</footer>
  </div>

<script>
/* ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆseedä¹±æ•°ï¼‰ ====== */
function xmur3(str){let h=1779033703^str.length;for(let i=0;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353);h=(h<<13)|(h>>>19)}return function(){h=Math.imul(h^(h>>>16),2246822507);h=Math.imul(h^(h>>>13),3266489909);return (h^=h>>>16)>>>0}}
function mulberry32(a){return function(){let t=(a+=0x6d2b79f5);t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return ((t^(t>>>14))>>>0)/4294967296}}
function seededPick(arr, seed){if(!arr.length) return undefined; const r=mulberry32(seed)(); return arr[Math.floor(r*arr.length)]}
function yyyymmdd(d){const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,"0");const dd=String(d.getDate()).padStart(2,"0");return `${y}${m}${dd}`}

/* ====== ãƒ‡ãƒ¼ã‚¿ ====== */
const PALETTE=[
  {key:"Mizu",   ja:"ãƒŸã‚ºã‚¤ãƒ­", hex:"#B7E3F9", alt:"ã†ãŒã„ãƒ¬ãƒ™ãƒ«ã®ã•ã£ã±ã‚Šæ„Ÿ"},
  {key:"Sakura", ja:"ã‚µã‚¯ãƒ©",   hex:"#FAD1E6", alt:"ã‚„ã‚ã‚‰ã‹ã„ä½™ç™½ã®æ°—åˆ†"},
  {key:"Mikan",  ja:"ãƒŸã‚«ãƒ³",   hex:"#FFB86B", alt:"å°ã•ãªé™½ã ã¾ã‚Š"},
  {key:"Matcha", ja:"ãƒãƒƒãƒãƒ£", hex:"#8AD1A0", alt:"é™ã‹ã«æ•´ã†"},
  {key:"Sumire", ja:"ã‚¹ãƒŸãƒ¬",   hex:"#A39BE8", alt:"ãµã‚“ã‚ã‚Šä½™éŸ»"},
  {key:"Hikari", ja:"ãƒ’ã‚«ãƒª",   hex:"#FFF3B0", alt:"ãµã£ã¨è»½ããªã‚‹"},
  {key:"Umi",    ja:"ã‚¦ãƒŸ",     hex:"#7FC8E3", alt:"æ·±å‘¼å¸ã¿ãŸã„ãªé’"},
  {key:"Hojicha",ja:"ã»ã†ã˜èŒ¶", hex:"#B08968", alt:"é¦™ã°ã—ã„è½ã¡ç€ã"}
];

const ONE_LINERS=[
 "è‚©ã®åŠ›ã‚’3%æŠœãã¨ã€æ™¯è‰²ãŒå°‘ã—åºƒãŒã‚‹æ—¥ã€‚",
 "å°ã•ãªã€ã¾ã‚ã„ã„ã‹ã€ãŒã€ã‚„ã•ã—ã„è¿½ã„é¢¨ã«ãªã‚‹ã€‚",
 "æ•´ã£ã¦ãªãã¦ã‚‚ã€é€²ã‚“ã§ã„ã‚‹ãªã‚‰ãã‚Œã§ååˆ†ã€‚",
 "äºˆå®šã‚ˆã‚Šã‚†ã£ãã‚Šã§ã€ã‚€ã—ã‚ã¡ã‚‡ã†ã©ã„ã„ã€‚",
 "ä¸å¯§ã«é£²ã‚€ä¸€å£ãŒã€åˆå¾Œã‚’ã¾ã‚ã‚„ã‹ã«ã™ã‚‹ã€‚",
 "ä»Šæ—¥ã¯ã€çŸ­ãè¨€ã†ã€ãŒä¼ã‚ã‚‹è¿‘é“ã€‚",
 "å…‰ã¯ã„ã¤ã‚‚ã€å°‘ã—é…ã‚Œã¦å±Šãã€‚",
 "â€œå¥½ãâ€ã‚’1ãƒŸãƒªå‰ã«å‡ºã™ã ã‘ã§ç©ºæ°—ãŒå¤‰ã‚ã‚‹ã€‚",
 "æ·±å‘¼å¸ã¯ã€ç„¡æ–™ã®ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã€‚",
 "èª°ã‹ã®ãƒšãƒ¼ã‚¹ã«ä¹—ã‚‰ãªãã¦å¤§ä¸ˆå¤«ã€ä»Šæ—¥ã¯è‡ªåˆ†ã®ãƒ†ãƒ³ãƒã§ã€‚",
 "ã‚„ã‚Šç›´ã—ã¯å¤±æ•—ã§ã¯ãªãã€å¾®èª¿æ•´ã®åˆ¥åã€‚",
 "ã²ã¨ã¤æ‰‹æ”¾ã™ã¨ã€ã²ã¨ã¤å…¥ã£ã¦ãã‚‹ã€‚",
 "è¿·ã£ãŸã‚‰ã€ã‚„ã‚ã‚‰ã‹ã„æ–¹ã‚’é¸ã¶ã€‚",
 "çŸ­æ‰€ã¯ã€å‘³ã€ã€é•·æ‰€ã¯ã€ä½™ç™½ã€ã§æ´»ãã‚‹ã€‚",
 "ã€ã¾ã ã€ã¯å¸Œæœ›ã®ç¾åœ¨å½¢ã€‚",
 "ã”æ©Ÿå«Œã¯ä½œã‚Œã‚‹ã€‚ã¾ãšå§¿å‹¢ã‚’1cmä¼¸ã°ã™ã€‚",
 "ã‚¬ãƒƒãƒ„ã‚ˆã‚Šã€ã‚†ã‚‹ã„ç¶™ç¶šãŒåŠ¹ã„ã¦ãã‚‹ã€‚",
 "ç©ºã‚’ä¸€å›è¦‹ä¸Šã’ã‚‹ã¨ã€è¶³å–ã‚ŠãŒè»½ããªã‚‹ã€‚",
 "ã€ãã‚Œã‚‚ã„ã„ã­ã€ã§ã€ä¸–ç•ŒãŒä¸¸ããªã‚‹ã€‚",
 "ä»Šæ—¥ã®ã‚ãªãŸã§ååˆ†ã™ã¦ãã€‚"
];

const ACTION_TIPS=[
 "æ°´ã‚’ä¸€æ¯ã€‚ã‚†ã£ãã‚Šé£²ã‚€ã€‚","5åˆ†ã ã‘ã‚¿ã‚¤ãƒãƒ¼ã§æ‰‹ã‚’å‹•ã‹ã™ã€‚","çª“è¾ºã§æ·±å‘¼å¸ã‚’3å›ã€‚","æœºã®ä¸Šã‚’30cmã ã‘ç‰‡ä»˜ã‘ã‚‹ã€‚","èª°ã‹ä¸€äººã«ã€ã‚ã‚ŠãŒã¨ã†ã€ã‚’é€ã‚‹ã€‚",
 "ãŠæ°—ã«å…¥ã‚Šã®éŸ³æ¥½ã‚’1æ›²ã ã‘ã€‚","æ­©å¹…ã‚’å°‘ã—åºƒãã—ã¦æ­©ãã€‚","å¥½ããªè‰²ã®ã‚‚ã®ã‚’èº«ã«ã¤ã‘ã‚‹ã€‚","ã‚¹ãƒãƒ›ã‚’10åˆ†é ã–ã‘ã‚‹ã€‚","ä»Šæ—¥ã®è‰¯ã‹ã£ãŸã“ã¨ã‚’ä¸€è¡Œãƒ¡ãƒ¢ã€‚",
 "å§¿å‹¢ã‚’1cmä¼¸ã°ã™ã€‚","ãŠã‚„ã¤ã‚’ä¸å¯§ã«å‘³ã‚ã†ã€‚","å…‰ã‚’å…¥ã‚Œã‚‹ã€‚ã‚«ãƒ¼ãƒ†ãƒ³å°‘ã—ã‚ªãƒ¼ãƒ—ãƒ³ã€‚","è¨€ã„æ›ãˆã‚’ä¸€å›è©¦ã™ã€‚","æ•£æ­©ã§è§’ã‚’ä¸€ã¤ã ã‘æ›²ãŒã‚‹ã€‚"
];

/* ====== çŠ¶æ…‹ãƒ»ä¿å­˜ ====== */
const LS_HISTORY="ichigo_omikuji_history_v1";
const LS_PREFS="ichigo_omikuji_prefs_v1";
const today=new Date(); const todayKey=yyyymmdd(today);

function loadHistory(){try{const raw=localStorage.getItem(LS_HISTORY);return raw?JSON.parse(raw):[]}catch{return []}}
function saveHistory(list){try{localStorage.setItem(LS_HISTORY,JSON.stringify(list.slice(0,30)))}catch{}}
function loadPrefs(){try{const raw=localStorage.getItem(LS_PREFS);return raw?JSON.parse(raw):{nickname:"",theme:"Sakura"}}catch{return {nickname:"",theme:"Sakura"}}}
function savePrefs(p){try{localStorage.setItem(LS_PREFS,JSON.stringify(p))}catch{}}
function hashNick(n){const h=xmur3(n||"guest")();return h.toString(16).slice(0,6)}

/* ====== DOMå‚ç…§ ====== */
const elApp=document.getElementById("app");
const elNick=document.getElementById("nick");
const elThemeS=document.getElementById("themeSakura");
const elThemeM=document.getElementById("themeMizu");
const elTabToday=document.getElementById("tabToday");
const elTabArchive=document.getElementById("tabArchive");
const paneToday=document.getElementById("paneToday");
const paneArchive=document.getElementById("paneArchive");
const yearEl=document.getElementById("year");
const btnReveal=document.getElementById("btnReveal");
const btnReroll=document.getElementById("btnReroll");
const btnShareImg=document.getElementById("btnShareImg");
const btnSaveImg=document.getElementById("btnSaveImg");
const btnCopy=document.getElementById("btnCopy");
const placeholder=document.getElementById("placeholder");
const content=document.getElementById("content");
const dateText=document.getElementById("dateText");
const oneLinerEl=document.getElementById("oneLiner");
const colorDot=document.getElementById("colorDot");
const colorJa=document.getElementById("colorJa");
const colorAlt=document.getElementById("colorAlt");
const tipText=document.getElementById("tipText");
const archList=document.getElementById("archList");
const card=document.getElementById("card");

let prefs=loadPrefs();
let history=loadHistory();
let revealed=null;
let rolledOnce=false;

function applyTheme(){
  if(prefs.theme==="Mizu"){ document.body.classList.add("mizu"); }
  else{ document.body.classList.remove("mizu"); }
  elThemeS.classList.toggle("active", prefs.theme==="Sakura");
  elThemeM.classList.toggle("active", prefs.theme==="Mizu");
}
function setTab(which){
  const t=(which==="today");
  elTabToday.classList.toggle("active", t);
  elTabArchive.classList.toggle("active", !t);
  paneToday.style.display=t?"block":"none";
  paneArchive.style.display=t?"none":"block";
}
function renderArchive(){
  const recent=history.slice(0,7);
  if(!recent.length){ archList.className="small muted"; archList.textContent="ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šæ—¥ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"; return; }
  archList.className=""; archList.innerHTML="";
  recent.forEach(r=>{
    const row=document.createElement("div");
    row.className="archive-item";
    const left=document.createElement("div");
    left.style.display="flex"; left.style.alignItems="center"; left.style.gap="8px";
    const dot=document.createElement("div"); dot.className="color-dot"; dot.style.background=r.colorHex;
    const info=document.createElement("div");
    const d=document.createElement("div"); d.className="small muted"; d.textContent=new Date(r.dateISO).toLocaleDateString("ja-JP")+(r.rerolled?"ï¼ˆå¼•ãç›´ã—ï¼‰":"");
    const line=document.createElement("div"); line.className="small"; line.textContent=r.oneLiner;
    info.appendChild(d); info.appendChild(line);
    left.appendChild(dot); left.appendChild(info);
    const btn=document.createElement("button"); btn.className="btn btn-ghost small"; btn.textContent="ã²ã‚‰ã";
    btn.addEventListener("click", ()=>{ revealFromReading(r); setTab("today"); });
    row.appendChild(left); row.appendChild(btn);
    archList.appendChild(row);
  });
}

/* ====== ãƒ­ã‚¸ãƒƒã‚¯ ====== */
function generate(seedStr, rerolled){
  const seed=xmur3(seedStr)();
  const color=seededPick(PALETTE, seed);
  const one=seededPick(ONE_LINERS, seed ^ 0x9e3779b1);
  const tip=seededPick(ACTION_TIPS, seed ^ 0x85ebca6b);
  const id=`${todayKey}:${hashNick(prefs.nickname)}:${rerolled?1:0}`;
  return {id, dateISO: new Date().toISOString(), nickname: prefs.nickname||"", oneLiner: one, colorKey: color.key, colorHex: color.hex, colorJa: color.ja, colorAlt: color.alt, tip, rerolled};
}

function revealFromReading(r){
  revealed=r; rolledOnce=!!r.rerolled;
  placeholder.style.display="none"; content.style.display="block";
  dateText.textContent=new Date().toLocaleDateString("ja-JP");
  oneLinerEl.textContent=r.oneLiner;
  colorDot.style.background=r.colorHex;
  colorJa.textContent="ãƒ©ãƒƒã‚­ãƒ¼è‰²ï¼š"+r.colorJa;
  colorAlt.textContent=r.colorAlt;
  tipText.textContent=r.tip;
  btnReroll.style.display = rolledOnce ? "none" : "inline-block";
}

function onReveal(){
  const seedStr=`${todayKey}-${(prefs.nickname||"guest")}`;
  const r=generate(seedStr,false);
  revealFromReading(r);
  history=[r, ...history.filter(h=>!h.id.startsWith(`${todayKey}:`))];
  saveHistory(history); renderArchive();
}
function onReroll(){
  if(rolledOnce) return;
  const seedStr=`${todayKey}-${(prefs.nickname||"guest")}-reroll`;
  const r=generate(seedStr,true);
  revealFromReading(r);
  rolledOnce=true;
  history=[r, ...history.filter(h=>!h.id.startsWith(`${todayKey}:`))];
  saveHistory(history); renderArchive();
}
async function shareOrDownload(){
  try{
    const dataUrl=await htmlToImage.toPng(card,{cacheBust:true,pixelRatio:2});
    const res=await fetch(dataUrl); const blob=await res.blob();
    const file=new File([blob],`ichigo_${todayKey}.png`,{type:"image/png"});
    if(navigator.canShare && navigator.canShare({files:[file]})){
      await navigator.share({files:[file], title:"ä¸€è¡ŒãŠã¿ãã˜", text:"ãã‚‡ã†ã®ãƒ’ãƒ³ãƒˆã€ãã£ã¨ç½®ã„ã¨ãã¾ã™ã€‚"});
    }else{
      const a=document.createElement("a"); a.href=dataUrl; a.download=`ichigo_${todayKey}.png`; a.click();
    }
  }catch(e){ console.error(e) }
}
async function copyText(){
  if(!revealed) return;
  const text=`ã€ä¸€è¡ŒãŠã¿ãã˜ã€‘\n${revealed.oneLiner}\nãƒ©ãƒƒã‚­ãƒ¼è‰²ï¼š${revealed.colorJa}ï¼ˆ${revealed.colorAlt}ï¼‰\nä»Šæ—¥ã®ã²ã¨ã“ã¨ï¼š${revealed.tip}`;
  try{ await navigator.clipboard.writeText(text); alert("ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ¨"); }
  catch{
    const ta=document.createElement("textarea"); ta.value=text; document.body.appendChild(ta);
    ta.select(); document.execCommand("copy"); ta.remove(); alert("ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ¨");
  }
}

/* ====== åˆæœŸåŒ– ====== */
(function init(){
  yearEl.textContent=String(new Date().getFullYear());
  elNick.value=prefs.nickname||"";
  applyTheme(); setTab("today"); renderArchive();

  // æ—¢ã«ä»Šæ—¥ã®çµæœãŒã‚ã‚Œã°è¡¨ç¤º
  const saved=history.find(r=>r.id.startsWith(`${todayKey}:`));
  if(saved){ revealFromReading(saved) }

  // ã‚¤ãƒ™ãƒ³ãƒˆ
  elNick.addEventListener("input", (e)=>{ prefs.nickname=e.target.value; savePrefs(prefs) });
  elThemeS.addEventListener("click", ()=>{ prefs.theme="Sakura"; savePrefs(prefs); applyTheme() });
  elThemeM.addEventListener("click", ()=>{ prefs.theme="Mizu";    savePrefs(prefs); applyTheme() });
  elTabToday.addEventListener("click", ()=>setTab("today"));
  elTabArchive.addEventListener("click", ()=>setTab("archive"));

  btnReveal.addEventListener("click", onReveal);
  btnReroll.addEventListener("click", onReroll);
  btnShareImg.addEventListener("click", shareOrDownload);
  btnSaveImg.addEventListener("click", shareOrDownload);
  btnCopy.addEventListener("click", copyText);
})();
</script>
</body>
</html>
